---
import { casos } from "@/lib/data";
---

<section id="casos" class="py-24 bg-slate-50 overflow-hidden">
  <div class="container mx-auto px-6">
    <div
      class="flex flex-col lg:flex-row justify-between items-end gap-6 mb-16"
    >
      <div class="max-w-2xl">
        <h2
          class="text-brand-primary font-bold tracking-[0.2em] uppercase text-[10px] mb-4"
        >
          Resultados
        </h2>
        <h3 class="text-4xl md:text-5xl font-serif text-slate-900 italic">
          Transformaciones <span class="text-brand-primary font-light"
            >que inspiran</span>
        </h3>
      </div>

      <div
        class="flex gap-2 bg-slate-200/50 p-1.5 rounded-2xl overflow-x-auto no-scrollbar w-full lg:w-auto"
      >
        {
          casos.map((caso, index) => (
            <button
              class={`case-tab px-6 w-full md:w-fit py-3 rounded-xl text-[10px] uppercase tracking-widest font-bold transition-all whitespace-nowrap ${index === 0 ? "bg-white text-slate-900 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
              data-index={index}
            >
              Caso {index + 1}
            </button>
          ))
        }
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
      <div
        class="lg:col-span-5 relative aspect-square md:aspect-video lg:aspect-square rounded-4xl overflow-hidden shadow-2xl group select-none bg-slate-200"
      >
        <div class="absolute inset-0">
          <img
            id="img-despues"
            src={casos[0].despues}
            alt="Después"
            class="w-full h-full object-cover transition-opacity duration-500"
          />
        </div>

        <div
          id="before-image"
          class="absolute inset-0 w-1/2 overflow-hidden border-r-2 border-white shadow-[10px_0_20px_rgba(0,0,0,0.2)]"
        >
          <img
            id="img-antes"
            src={casos[0].antes}
            alt="Antes"
            class="absolute inset-0 w-screen h-full object-cover max-w-none transition-opacity duration-500"
          />
        </div>

        <div
          id="slider-handle"
          class="absolute top-0 bottom-0 left-1/2 w-1 bg-white z-30 cursor-ew-resize"
        >
          <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full shadow-xl flex items-center justify-center gap-1"
          >
            <div class="w-0.5 h-3 bg-slate-300 rounded-full"></div>
            <div class="w-0.5 h-3 bg-slate-300 rounded-full"></div>
          </div>
        </div>

        <input
          type="range"
          min="0"
          max="100"
          value="50"
          class="absolute inset-0 w-full h-full opacity-0 z-40 cursor-ew-resize"
          id="comparison-slider"
        />
      </div>

      <div class="lg:col-span-7 lg:pl-6">
        <div id="case-content" class="animate-fade-in">
          <div
            class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm mb-6"
          >
            <span class="relative flex h-2 w-2">
              <span
                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-primary opacity-75"
              ></span>
              <span
                class="relative inline-flex rounded-full h-2 w-2 bg-brand-primary"
              ></span>
            </span>
            <span
              class="text-[10px] font-bold uppercase tracking-widest text-slate-600"
              >Galería de Éxitos</span
            >
          </div>

          <h4
            id="case-title"
            class="text-3xl md:text-4xl font-serif text-slate-900 mb-6 transition-all"
          >
            {casos[0].titulo}
          </h4>
          <p
            id="case-description"
            class="text-slate-600 font-light leading-relaxed mb-8 text-lg"
          >
            {casos[0].descripcion}
          </p>

          <div id="case-tags" class="flex flex-wrap gap-2 mb-10">
            {
              casos[0].tags.map((tag) => (
                <span class="px-4 py-1.5 rounded-full bg-slate-200/50 text-slate-500 text-[10px] uppercase font-bold tracking-wider">
                  {tag}
                </span>
              ))
            }
          </div>

          <a
            href="#reserva"
            class="inline-block px-10 py-4 bg-slate-900 text-white rounded-2xl font-bold text-[11px] uppercase tracking-widest hover:bg-brand-primary transition-all shadow-lg hover:shadow-brand-primary/20"
          >
            Quiero resultados similares
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline define:vars={{ casos }}>
  const slider = document.getElementById("comparison-slider");
  const beforeImage = document.getElementById("before-image");
  const sliderHandle = document.getElementById("slider-handle");
  const imgAntes = document.getElementById("img-antes");
  const imgDespues = document.getElementById("img-despues");

  const title = document.getElementById("case-title");
  const description = document.getElementById("case-description");
  const tagsContainer = document.getElementById("case-tags");
  const tabs = document.querySelectorAll(".case-tab");

  slider.addEventListener("input", (e) => {
    const value = e.target.value + "%";
    beforeImage.style.width = value;
    sliderHandle.style.left = value;
  });

  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const index = tab.getAttribute("data-index");
      const caso = casos[index];

      tabs.forEach((t) =>
        t.classList.remove("bg-white", "text-slate-900", "shadow-sm"),
      );
      tabs.forEach((t) => t.classList.add("text-slate-500"));
      tab.classList.add("bg-white", "text-slate-900", "shadow-sm");
      tab.classList.remove("text-slate-500");

      [imgAntes, imgDespues, title, description, tagsContainer].forEach(
        (el) => (el.style.opacity = "0"),
      );

      setTimeout(() => {
        imgAntes.src = caso.antes;
        imgDespues.src = caso.despues;
        title.innerText = caso.titulo;
        description.innerText = caso.descripcion;

        tagsContainer.innerHTML = caso.tags
          .map(
            (tag) =>
              `<span class="px-4 py-1.5 rounded-full bg-slate-200/50 text-slate-500 text-[10px] uppercase font-bold tracking-tight">${tag}</span>`,
          )
          .join("");

        [imgAntes, imgDespues, title, description, tagsContainer].forEach(
          (el) => (el.style.opacity = "1"),
        );
        updateImageWidth();
      }, 300);
    });
  });

  const updateImageWidth = () => {
    imgAntes.style.width = imgDespues.offsetWidth + "px";
  };
  window.addEventListener("resize", updateImageWidth);
  updateImageWidth();
</script>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  #comparison-slider::-webkit-slider-thumb {
    width: 60px;
    height: 100vh;
    appearance: none;
    cursor: ew-resize;
  }

  /* Animación suave para el cambio de contenido */
  #img-antes,
  #img-despues,
  #case-title,
  #case-description,
  #case-tags {
    transition: opacity 0.4s ease-in-out;
  }
</style>
